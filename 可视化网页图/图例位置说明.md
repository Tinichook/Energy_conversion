# 图例位置优化说明

## 更新内容

### 图例位置调整
**从左上角移至右上角**

**原因**：
- 左上角容易遮挡曲线的起始部分
- 右上角通常是空白区域（大部分曲线在右侧趋于平缓）
- 符合常见图表规范

### 具体位置

**计算方式**：
```javascript
// 图例位置：右上角
const legendX = chartPadding.left + chartWidth - legendWidth - 10;
const legendY = chartPadding.top + 10;
```

**说明**：
- X坐标：图表右边界 - 图例宽度 - 10px边距
- Y坐标：图表上边界 + 10px边距

### 图例尺寸

**自适应设计**：
- 最多2列显示
- 根据风机数量自动计算行数
- 每项宽度：120px
- 每项高度：20px
- 内边距：10px

**示例**：
```
选择2个风机：1行2列
选择3个风机：2行2列
选择4个风机：2行2列
选择5个风机：3行2列
```

### 视觉效果

**背景**：
- 半透明白色：rgba(255, 255, 255, 0.95)
- 透明度95%，既清晰又不完全遮挡

**边框**：
- 浅灰色：#ccc
- 线宽：1px

**文字**：
- 字体：11px Arial
- 颜色：#333（深灰色）

### 优势

✅ **不遮挡关键曲线**：
- 功率曲线的起始段（低风速区）
- Cp曲线的峰值区域
- 日功率曲线的波动部分

✅ **视觉平衡**：
- 右上角位置符合视觉习惯
- 与图表标题形成对称

✅ **专业规范**：
- 符合学术论文图表规范
- 符合工程报告图表规范

### 对比

| 位置 | 优点 | 缺点 |
|------|------|------|
| 左上角 | 靠近Y轴标签 | 遮挡曲线起始段 |
| **右上角** ⭐ | **不遮挡关键区域** | 无明显缺点 |
| 左下角 | 靠近原点 | 遮挡低功率区域 |
| 右下角 | 空白区域 | 远离图表主体 |

### 适用图表

本优化应用于以下三个图表：

1. **静态功率曲线（P-V）**
   - 图例在右上角
   - 不遮挡曲线上升段

2. **Cp曲线（Cp-V）**
   - 图例在右上角
   - 不遮挡Cp峰值区域

3. **日功率曲线（P-t）**
   - 图例在右上角
   - 不遮挡功率波动

### 技术实现

**函数签名**：
```javascript
function drawLegendInChart(ctx, selectedIds, chartPadding, chartWidth, chartHeight)
```

**参数说明**：
- `ctx`: Canvas 2D上下文
- `selectedIds`: 选中的风机ID数组
- `chartPadding`: 图表内边距对象 {top, right, bottom, left}
- `chartWidth`: 图表宽度（不含padding）
- `chartHeight`: 图表高度（不含padding）

**调用示例**：
```javascript
// 在绘制完曲线后调用
drawLegendInChart(ctx, selectedIds, padding, chartWidth, chartHeight);
```

### 用户反馈

如果图例仍然遮挡曲线，可以考虑以下调整：

1. **移至图表外部**：
   - 放在图表下方
   - 水平排列

2. **调整透明度**：
   - 增加透明度（降低alpha值）
   - 例如：rgba(255, 255, 255, 0.85)

3. **缩小图例**：
   - 减小字体大小
   - 减小行高

4. **可拖动图例**：
   - 添加鼠标交互
   - 允许用户拖动图例位置

---

**更新日期**：2025年1月5日  
**版本**：v2.1.1  
**改进**：图例位置从左上角移至右上角
