# 逆变器选型方法

## 1. 选型原则

### 1.1 基本原则
- **电压匹配**：逆变器MPPT电压范围必须覆盖光伏组件工作电压范围
- **容量匹配**：考虑容配比，逆变器容量通常为光伏容量的80%-120%
- **组串配置**：合理配置组串数量，充分利用MPPT路数
- **经济性**：在满足技术要求的前提下，优化设备成本
- **效率优先**：选择高效率逆变器，降低系统损耗

### 1.2 容配比设计
容配比 = 光伏组件容量 / 逆变器容量

**推荐范围**：
- 高辐照地区（如山地区、农业区）：1.1 ~ 1.3
- 中等辐照地区（如工业区、居民区）：1.0 ~ 1.2
- 低辐照地区（如林业区）：0.9 ~ 1.1

**原因**：
- 光伏组件实际输出功率受温度、辐照等影响，很少达到标称功率
- 适当超配可提高逆变器利用率，降低度电成本
- 过度超配会导致削峰损失增加

## 2. 电气参数计算

### 2.1 组串设计

#### 串联数量计算
```
最小串联数 = MPPT电压下限 / 组件最大功率点电压(Vmp)
最大串联数 = min(
  逆变器最大直流电压 / 组件开路电压(Voc),
  逆变器最大直流电压 × 0.9 / (组件Voc × 温度系数修正)
)
```

**温度修正**：
- 最低温度下Voc会升高：Voc_max = Voc × [1 + |温度系数| × (25 - T_min)]
- 最高温度下Vmp会降低：Vmp_min = Vmp × [1 + |温度系数| × (25 - T_max)]

#### 并联路数计算
```
单路最大电流 = 组件短路电流(Isc) × 安全系数(1.25)
并联路数 = 逆变器最大输入电流 / 单路最大电流
```

### 2.2 MPPT配置

**MPPT路数选择**：
- 小型系统（<50kW）：1-2路MPPT
- 中型系统（50-200kW）：2-4路MPPT
- 大型系统（>200kW）：4-12路MPPT

**优势**：
- 多路MPPT可应对不同朝向、倾角的组件阵列
- 减少阴影遮挡对整体发电的影响
- 提高系统发电效率

## 3. 逆变器类型选择

### 3.1 组串式逆变器
**适用场景**：
- 小型分布式光伏（<500kW）
- 屋顶光伏系统
- 地形复杂、阴影遮挡较多的场景

**优点**：
- MPPT路数多，适应性强
- 模块化设计，易于扩展
- 单台故障影响小

**缺点**：
- 单位成本相对较高
- 需要更多安装空间

### 3.2 集中式逆变器
**适用场景**：
- 大型地面光伏电站（>500kW）
- 地形平坦、辐照均匀的场景
- 集中并网的工业区

**优点**：
- 单位成本低
- 维护集中，便于管理
- 高压并网，减少线损

**缺点**：
- MPPT路数少，适应性差
- 单台故障影响大
- 需要专用机房

## 4. 选型流程

### 4.1 第一步：确定光伏组件参数
- 组件型号、功率
- Voc、Vmp、Isc、Imp
- 温度系数
- 组件数量

### 4.2 第二步：计算组串配置
```typescript
// 示例：PV-410M组件
const panel = {
  power: 410,      // W
  Voc: 37.2,       // V
  Vmp: 31.0,       // V
  Isc: 13.96,      // A
  Imp: 13.23,      // A
  tempCoeffVoc: -0.25  // %/°C
};

// 假设环境温度范围：-10°C ~ 60°C
const T_min = -10;
const T_max = 60;

// 温度修正
const Voc_max = panel.Voc * (1 + Math.abs(panel.tempCoeffVoc/100) * (25 - T_min));
// Voc_max = 37.2 * (1 + 0.0025 * 35) = 40.5V

const Vmp_min = panel.Vmp * (1 - Math.abs(panel.tempCoeffVoc/100) * (T_max - 25));
// Vmp_min = 31.0 * (1 - 0.0025 * 35) = 28.3V

// 对于INV-110K逆变器
const inverter = {
  ratedPower: 110,           // kW
  maxDCVoltage: 1500,        // V
  MPPTVoltageMin: 200,       // V
  MPPTVoltageMax: 1100,      // V
  MPPTCount: 6,
  maxInputCurrent: 30        // A per MPPT
};

// 串联数量
const串联最小 = Math.ceil(inverter.MPPTVoltageMin / panel.Vmp);
// = ceil(200 / 31.0) = 7块

const串联最大 = Math.floor(Math.min(
  inverter.maxDCVoltage / Voc_max,
  inverter.MPPTVoltageMax / panel.Vmp
));
// = floor(min(1500/40.5, 1100/31.0)) = floor(min(37, 35)) = 35块

// 推荐串联数：选择中间值，优先考虑MPPT工作在最佳电压范围
const推荐串联 = Math.floor((inverter.MPPTVoltageMin + inverter.MPPTVoltageMax) / 2 / panel.Vmp);
// = floor(650 / 31.0) = 20块
```

### 4.3 第三步：确定容配比
```typescript
// 根据区域类型确定容配比
function getCapacityRatio(regionType: string): number {
  const ratios = {
    '山地区': 1.25,      // 高辐照
    '农业区': 1.20,
    '工业区': 1.10,
    '居民区': 1.10,
    '林业区': 1.00       // 低辐照
  };
  return ratios[regionType] || 1.10;
}

// 计算所需逆变器容量
const solarCapacityKW = 5000;  // 光伏装机容量 5MW
const regionType = '农业区';
const capacityRatio = getCapacityRatio(regionType);

const inverterCapacityKW = solarCapacityKW / capacityRatio;
// = 5000 / 1.20 = 4167 kW
```

### 4.4 第四步：选择逆变器型号
```typescript
// 优先级排序规则
function scoreInverter(inverter, targetKW, panelVmp, panelVoc) {
  let score = 0;
  
  // 1. 容量匹配度（权重40%）
  const capacityMatch = 1 - Math.abs(inverter.ratedPower - targetKW) / targetKW;
  score += capacityMatch * 40;
  
  // 2. 效率（权重30%）
  const efficiencyScore = (inverter.maxEfficiency - 95) / 5; // 归一化到0-1
  score += efficiencyScore * 30;
  
  // 3. MPPT电压匹配度（权重20%）
  const optimalVoltage = (inverter.MPPTVoltageMin + inverter.MPPTVoltageMax) / 2;
  const串联数 = Math.round(optimalVoltage / panelVmp);
  const actualVoltage = 串联数 * panelVmp;
  const voltageMatch = 1 - Math.abs(actualVoltage - optimalVoltage) / optimalVoltage;
  score += voltageMatch * 20;
  
  // 4. 经济性（权重10%）
  const pricePerKW = inverter.price / inverter.ratedPower;
  const economyScore = 1 - (pricePerKW - 0.03) / 0.05; // 假设价格范围0.03-0.08万元/kW
  score += Math.max(0, economyScore) * 10;
  
  return score;
}
```

### 4.5 第五步：组合配置
```typescript
// 多台逆变器组合配置
function selectInverterCombination(targetKW, inverters, panel) {
  const combinations = [];
  
  // 单一型号配置
  for (const inv of inverters) {
    const count = Math.round(targetKW / inv.ratedPower);
    if (count > 0 && count <= 100) {
      combinations.push({
        inverters: [{ model: inv, count }],
        totalCapacity: count * inv.ratedPower,
        totalCost: count * inv.price,
        avgEfficiency: inv.maxEfficiency,
        score: scoreInverter(inv, targetKW / count, panel.Vmp, panel.Voc)
      });
    }
  }
  
  // 混合配置（大+小）
  const large = inverters.filter(i => i.ratedPower >= 100);
  const small = inverters.filter(i => i.ratedPower < 100);
  
  for (const largeInv of large) {
    const largeCount = Math.floor(targetKW / largeInv.ratedPower);
    const remaining = targetKW - largeCount * largeInv.ratedPower;
    
    if (remaining > 0 && largeCount > 0) {
      for (const smallInv of small) {
        const smallCount = Math.ceil(remaining / smallInv.ratedPower);
        if (smallCount <= 10) {
          const totalCapacity = largeCount * largeInv.ratedPower + smallCount * smallInv.ratedPower;
          const totalCost = largeCount * largeInv.price + smallCount * smallInv.price;
          const avgEfficiency = (
            largeInv.maxEfficiency * largeCount * largeInv.ratedPower +
            smallInv.maxEfficiency * smallCount * smallInv.ratedPower
          ) / totalCapacity;
          
          combinations.push({
            inverters: [
              { model: largeInv, count: largeCount },
              { model: smallInv, count: smallCount }
            ],
            totalCapacity,
            totalCost,
            avgEfficiency,
            score: (scoreInverter(largeInv, largeInv.ratedPower, panel.Vmp, panel.Voc) +
                   scoreInverter(smallInv, smallInv.ratedPower, panel.Vmp, panel.Voc)) / 2
          });
        }
      }
    }
  }
  
  // 按综合得分排序
  combinations.sort((a, b) => b.score - a.score);
  
  return combinations[0]; // 返回最优方案
}
```

## 5. 完整选型算法

```typescript
export function selectInvertersAdvanced(
  solarMW: number,
  panelConfig: { model: string; count: number; Vmp: number; Voc: number; Isc: number },
  regionType: string
): EquipmentSelection[] {
  if (solarMW <= 0) return [];
  
  // 1. 确定容配比
  const capacityRatio = getCapacityRatio(regionType);
  const targetInverterKW = (solarMW * 1000) / capacityRatio;
  
  // 2. 筛选合适的逆变器
  const suitableInverters = INVERTERS.filter(inv => {
    // 电压匹配检查
    const minStrings = Math.ceil(inv.MPPTVoltageMin / panelConfig.Vmp);
    const maxStrings = Math.floor(inv.maxDCVoltage * 0.9 / panelConfig.Voc);
    
    if (minStrings > maxStrings) return false;
    
    // 电流匹配检查
    const maxCurrentPerMPPT = panelConfig.Isc * 1.25;
    if (maxCurrentPerMPPT > inv.maxInputCurrent) return false;
    
    return true;
  });
  
  if (suitableInverters.length === 0) {
    // 降级处理：返回所有逆变器
    return selectInvertersBasic(solarMW);
  }
  
  // 3. 评分排序
  const scoredInverters = suitableInverters.map(inv => ({
    inverter: inv,
    score: scoreInverter(inv, targetInverterKW, panelConfig.Vmp, panelConfig.Voc)
  })).sort((a, b) => b.score - a.score);
  
  // 4. 选择最优组合
  const bestCombination = selectInverterCombination(
    targetInverterKW,
    scoredInverters.map(s => s.inverter),
    panelConfig
  );
  
  // 5. 转换为EquipmentSelection格式
  return bestCombination.inverters.map(item => ({
    model: item.model.model,
    manufacturer: item.model.manufacturer,
    count: item.count,
    unitCapacity: item.model.ratedPower,
    totalCapacity: item.count * item.model.ratedPower,
    unitPrice: item.model.price,
    totalPrice: item.count * item.model.price
  }));
}

// 基础选型方法（作为降级方案）
function selectInvertersBasic(solarMW: number): EquipmentSelection[] {
  const targetKW = solarMW * 1000;
  const sorted = [...INVERTERS].sort((a, b) => b.ratedPower - a.ratedPower);
  
  let remaining = targetKW;
  const selections: EquipmentSelection[] = [];
  
  for (const inverter of sorted) {
    if (remaining <= 0) break;
    
    const count = Math.floor(remaining / inverter.ratedPower);
    if (count > 0) {
      selections.push({
        model: inverter.model,
        manufacturer: inverter.manufacturer,
        count,
        unitCapacity: inverter.ratedPower,
        totalCapacity: count * inverter.ratedPower,
        unitPrice: inverter.price,
        totalPrice: count * inverter.price
      });
      remaining -= count * inverter.ratedPower;
    }
  }
  
  if (remaining > 0) {
    const smallest = sorted[sorted.length - 1];
    const count = Math.ceil(remaining / smallest.ratedPower);
    selections.push({
      model: smallest.model,
      manufacturer: smallest.manufacturer,
      count,
      unitCapacity: smallest.ratedPower,
      totalCapacity: count * smallest.ratedPower,
      unitPrice: smallest.price,
      totalPrice: count * smallest.price
    });
  }
  
  return selections;
}
```

## 6. 选型示例

### 示例1：工业区5MW光伏系统

**输入参数**：
- 光伏容量：5 MW
- 组件型号：PV-545N (Vmp=41.58V, Voc=49.62V, Isc=13.98A)
- 组件数量：9174块
- 区域类型：工业区

**计算过程**：

1. **容配比**：工业区推荐1.10，逆变器容量 = 5000 / 1.10 = 4545 kW

2. **组串设计**（以INV-110K为例）：
   - 串联数：200V / 41.58V ≈ 5块（最小），1100V / 41.58V ≈ 26块（最大）
   - 推荐串联：20块（工作电压832V，在MPPT范围内）
   - 单路电流：13.98A × 1.25 = 17.5A < 30A ✓
   - 每台逆变器：6路MPPT × 20块/路 = 120块组件

3. **逆变器选型**：
   - 主力机型：INV-110K × 41台 = 4510 kW
   - 补充机型：INV-50K × 1台 = 50 kW
   - 总容量：4560 kW
   - 实际容配比：5000 / 4560 = 1.096

4. **经济性分析**：
   - 总成本：41 × 4.2 + 1 × 2.2 = 174.4万元
   - 单位成本：174.4 / 4560 = 0.038万元/kW
   - 加权效率：98.8%

### 示例2：农业区2MW光伏系统

**输入参数**：
- 光伏容量：2 MW
- 组件型号：PV-410M (Vmp=31.0V, Voc=37.2V, Isc=13.96A)
- 组件数量：4878块
- 区域类型：农业区

**计算过程**：

1. **容配比**：农业区推荐1.20，逆变器容量 = 2000 / 1.20 = 1667 kW

2. **组串设计**（以INV-50K为例）：
   - 串联数：200V / 31.0V ≈ 7块（最小），1000V / 37.2V ≈ 26块（最大）
   - 推荐串联：21块（工作电压651V）
   - 每台逆变器：4路MPPT × 21块/路 = 84块组件

3. **逆变器选型**：
   - 主力机型：INV-50K × 33台 = 1650 kW
   - 补充机型：INV-20K × 1台 = 20 kW
   - 总容量：1670 kW
   - 实际容配比：2000 / 1670 = 1.198

4. **经济性分析**：
   - 总成本：33 × 2.2 + 1 × 1.0 = 73.6万元
   - 单位成本：73.6 / 1670 = 0.044万元/kW
   - 加权效率：98.6%

## 7. 注意事项

### 7.1 安全裕度
- 最大直流电压应留10%安全裕度
- 最大输入电流应留25%安全裕度
- 考虑极端温度对电压的影响

### 7.2 系统配置
- 尽量使用同一型号逆变器，便于维护
- 大型系统可采用"大机型为主+小机型补充"的配置
- 预留10%-20%扩容空间

### 7.3 并网要求
- 满足电网电压等级要求
- 具备防孤岛保护功能
- 满足电能质量标准（THD<5%）

### 7.4 环境适应
- 考虑安装环境的温度、湿度、海拔
- 户外安装需IP65及以上防护等级
- 高海拔地区需降容使用

## 8. 总结

完善的逆变器选型应综合考虑：
1. **电气匹配**：电压、电流、功率的全面匹配
2. **容配比优化**：根据辐照条件合理超配
3. **组串设计**：充分利用MPPT路数，提高发电效率
4. **经济性**：在满足技术要求的前提下，优化投资成本
5. **可靠性**：选择知名品牌，确保长期稳定运行

通过以上方法，可以选出技术合理、经济优化的逆变器配置方案。
