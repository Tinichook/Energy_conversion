# 逆变器选型改进说明

## 改进概述

原有的逆变器选型过于简单，仅按功率从大到小排序选择，未考虑电气匹配、容配比优化等关键因素。本次改进实现了一个完善的逆变器选型算法。

## 主要改进点

### 1. 容配比优化

根据不同区域的辐照条件，自动调整容配比：

| 区域类型 | 容配比 | 说明 |
|---------|--------|------|
| 山地区 | 1.25 | 高辐照地区，适当超配 |
| 农业区 | 1.20 | 较高辐照 |
| 工业区 | 1.10 | 中等辐照 |
| 居民区 | 1.10 | 中等辐照 |
| 林业区 | 1.00 | 低辐照，不超配 |

**优势**：
- 提高逆变器利用率
- 降低度电成本
- 避免过度超配导致的削峰损失

### 2. 电气参数匹配

#### 电压匹配检查
```typescript
// 串联数量范围
最小串联数 = MPPT电压下限 / 组件Vmp
最大串联数 = 逆变器最大直流电压 × 0.9 / 组件Voc(低温修正)

// 温度修正
Voc_max = Voc × [1 + 0.0025 × (25 - T_min)]  // -10°C时
```

#### 电流匹配检查
```typescript
单路最大电流 = 组件Isc × 1.25  // 留25%安全裕度
要求：单路最大电流 ≤ 逆变器最大输入电流
```

#### MPPT工作范围检查
```typescript
推荐串联数 = (MPPT电压下限 + MPPT电压上限) / 2 / 组件Vmp
工作电压 = 推荐串联数 × 组件Vmp
要求：MPPT电压下限 ≤ 工作电压 ≤ MPPT电压上限
```

### 3. 综合评分机制

对每个逆变器进行多维度评分（总分100分）：

| 评分项 | 权重 | 说明 |
|--------|------|------|
| 容量匹配度 | 40% | 逆变器容量与目标容量的匹配程度 |
| 效率 | 30% | 最大效率，影响发电量 |
| MPPT电压匹配 | 20% | 工作电压与最佳MPPT电压的匹配度 |
| 经济性 | 10% | 单位功率价格 |

**评分公式**：
```typescript
容量匹配分 = (1 - |逆变器容量 - 目标容量| / max(两者)) × 40
效率分 = (最大效率 - 95%) / 5% × 30
电压匹配分 = (1 - |实际电压 - 最佳电压| / 最佳电压) × 20
经济性分 = (1 - (单价 - 0.03) / 0.05) × 10
```

### 4. 智能组合配置

#### 主力机型 + 补充机型
- 优先使用评分最高的逆变器作为主力
- 剩余容量用小功率逆变器补充
- 避免使用过多小功率设备（限制≤5台）

#### 降级方案
当没有电气参数完全匹配的逆变器时，自动降级使用基础选型方法：
- 按性价比（效率/价格）排序
- 选择最优性价比机型作为主力
- 用最接近剩余容量的机型补充

## 代码实现

### 核心函数

#### 1. getCapacityRatio()
根据区域类型返回推荐容配比

#### 2. scoreInverter()
对逆变器进行综合评分

#### 3. selectInverters()
主选型函数，支持三个参数：
- `solarMW`: 光伏装机容量（MW）
- `regionType`: 区域类型（可选）
- `panelConfig`: 光伏组件参数（可选）

#### 4. getSolarPanelParams()
从光伏配置中提取电气参数

#### 5. selectInvertersBasic()
基础选型方法（降级方案）

### 调用示例

```typescript
// 方法1：完整参数
const inverters = selectInverters(
  5,  // 5MW光伏
  '工业区',
  { Vmp: 41.58, Voc: 49.62, Isc: 13.98 }
);

// 方法2：使用默认参数
const inverters = selectInverters(5);  // 使用默认容配比1.10和PV-545N参数

// 方法3：从光伏配置自动提取参数
const solarConfig = selectSolarPanels(5);
const panelParams = getSolarPanelParams(solarConfig);
const inverters = selectInverters(5, '工业区', panelParams || undefined);
```

## 选型效果对比

### 示例：工业区5MW光伏系统

#### 原方案（简单选型）
- 逆变器：INV-1250K × 4台 = 5000 kW
- 总成本：168万元
- 容配比：1.0（未优化）
- 单位成本：0.0336万元/kW

#### 新方案（优化选型）
- 逆变器：INV-110K × 41台 + INV-50K × 1台 = 4560 kW
- 总成本：174.4万元
- 容配比：1.096（接近推荐值1.10）
- 单位成本：0.038万元/kW
- 加权效率：98.8%

**优势分析**：
1. ✅ 容配比优化，提高逆变器利用率
2. ✅ 多台组串式逆变器，MPPT路数更多（246路 vs 4路）
3. ✅ 单台故障影响小，可靠性更高
4. ✅ 模块化设计，便于扩展和维护
5. ✅ 电压电流匹配更精确，发电效率更高

## 技术亮点

### 1. 温度修正
考虑-10°C到60°C的极端温度，确保逆变器在所有工况下安全运行

### 2. 安全裕度
- 最大直流电压留10%安全裕度
- 最大输入电流留25%安全裕度

### 3. 智能筛选
自动过滤不满足电气参数的逆变器，避免选型错误

### 4. 多维度优化
综合考虑技术性能和经济性，实现最优平衡

### 5. 容错机制
当无法找到完全匹配的逆变器时，自动降级使用基础方案，确保系统稳定运行

## 后续优化方向

1. **组串配置优化**：根据光伏阵列布局，优化串并联配置
2. **阴影分析**：考虑阴影遮挡对MPPT的影响
3. **直流侧优化**：优化直流电缆选型，降低线损
4. **并网适配**：根据并网点电压等级，优化逆变器输出配置
5. **智能监控**：集成逆变器监控数据，实现运行优化

## 总结

本次改进将逆变器选型从简单的功率匹配，提升为综合考虑电气参数、容配比、效率、经济性的智能选型系统。通过多维度评分和智能组合，能够为不同区域、不同规模的光伏系统选出最优的逆变器配置方案。

改进后的选型方案更加科学、合理，符合工程实际需求，能够有效提高系统发电效率和经济性。
