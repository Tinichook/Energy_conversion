# 能源系统优化求解使用说明

## 一、求解方法概述

本系统提供两种优化求解方式：

### 1. 前端界面求解（推荐）

通过 Web 界面进行交互式优化求解，支持实时查看进度和结果。

**启动方式：**
```bash
cd energy-system
npm run dev
```

然后在浏览器中打开 http://localhost:5173，进入"数据核对"面板。

**操作步骤：**
1. 选择目标区域（如测试区-1）
2. 点击"开始优化"按钮
3. 等待优化完成（可随时暂停）
4. 查看最优方案列表
5. 导出结果为 JSON 或 CSV

### 2. 命令行求解

通过脚本直接运行优化求解，适合批量处理。

**文件位置：**
- `energy-system/run-optimization.ts` - 命令行求解脚本
- `energy-system/generate-solution-report.ts` - 报告生成脚本

**运行方式：**
```bash
cd energy-system
npx ts-node run-optimization.ts --region 53 --format markdown --max 20
```

**参数说明：**
- `--region`: 区域ID（1-55，53-55为测试区）
- `--student`: 学号（可选，用于数据波动）
- `--format`: 输出格式（console/markdown/json）
- `--max`: 最大输出方案数

---

## 二、核心算法说明

### 2.1 优化引擎

核心代码位于 `energy-system/src/OptimizationEngine.ts`，主要功能：

```typescript
// 1. 执行优化求解
const solutions = await findOptimalSolutions(region, onProgress, cancelSignal);

// 2. 执行8760小时仿真
const simulation = simulate8760Hours(config, region);

// 3. 计算方案评分
const score = calculateScore(config, simulation, optimalCost);
```

### 2.2 搜索策略

优化采用多维参数搜索策略：

1. **风光配比搜索**：根据区域资源特点动态生成配比组合
2. **储能容量搜索**：从0.5小时到24小时的多档位搜索
3. **设备选型**：自动匹配最优性价比设备
4. **生物质路线**：评估直燃/气化/沼气三种路线

### 2.3 约束条件

- 供电可靠率 ≥ 98%
- 设备容量匹配合理
- 逆变器容配比 0.8-1.2
- PCS功率与电池容量匹配

### 2.4 评分体系

| 评分项 | 分值 | 说明 |
|--------|------|------|
| 可靠性 | 0-30 | 基于供电可靠率 |
| 设备匹配 | 0-20 | 容配比、链路完整性 |
| 经济性 | 0-30 | 与最优成本对比 |
| 稳定性 | 0-10 | SOC波动、弃电率 |
| 小组加分 | 0-10 | 联合优化加分 |

---

## 三、输出格式

### 3.1 方案报告格式

每个方案包含以下信息：

```markdown
### 方案X：方案名称
**评分：XX分** | 约束：✓全部满足

| 设备类型 | 型号 | 数量 | 单台功率 | 总容量 | 总价(万元) |
|---------|------|------|---------|--------|-----------|
| 风机 | ... | ... | ... | ... | ... |
| 光伏组件 | ... | ... | ... | ... | ... |
| ... | ... | ... | ... | ... | ... |

**能源占比：** 风电 XX% | 光伏 XX% | 生物质 XX% | **总计 XX%**
**经济指标：** 总投资 XX万元 | 年发电量 XX MWh | LCOE X.XX元/kWh
**仿真结果：** 可靠率 XX% | 弃电率 XX% | 缺电Xh | SOC X-X%
```

### 3.2 JSON 输出格式

```json
{
  "rank": 1,
  "name": "综合最优型",
  "score": 92,
  "reliability": 99.85,
  "curtailmentRate": 5.2,
  "totalCost": 37024,
  "LCOE": 0.198,
  "capacity": {
    "windMW": 24.0,
    "solarMW": 65.4,
    "biomassMW": 2.4,
    "batteryMWh": 40.2
  },
  "energyRatio": {
    "wind": 0.285,
    "solar": 0.652,
    "bio": 0.128,
    "total": 1.065
  }
}
```

---

## 四、示例报告

完整的求解报告示例请参考：
- `MD方案/测试区-1代码求解方案.md`
- `MD方案/测试区-1代码求解方案-示例.md`
- `MD方案/测试区-1最优方案集.md`

---

## 五、常见问题

### Q1: 优化时间太长怎么办？
A: 可以点击"暂停"按钮，系统会保存当前已找到的可行方案。

### Q2: 没有找到可行方案怎么办？
A: 检查区域参数是否合理，特别是负荷和资源数据。可以尝试放宽约束条件。

### Q3: 如何比较不同区域的方案？
A: 使用"导出所有解决方案"功能，将所有区域的最优解导出为JSON文件进行对比。

### Q4: 如何自定义搜索范围？
A: 修改 `OptimizationEngine.ts` 中的 `estimateSearchRanges` 函数。

---

**文档版本**：v1.0  
**更新日期**：2026年1月6日
